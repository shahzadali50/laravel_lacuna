import{A as R}from"./AdminLayout-Bv0R89G9.js";import{d as X,p as d,c,z as L,r as p,a as _,o as b,s as U,e as t,w as o,u as Q,m as Z,b as l,g as F,F as $,q as ee,t as r,N as le,O as z,W as te}from"./app-CveD8GQJ.js";import"./LanguageSwitcher.vue_vue_type_script_setup_true_lang-DbCxXuqh.js";const ae={key:0,class:"loading-overlay"},se={class:"mb-4"},oe={class:"mb-4"},ue={class:"mb-4"},ne={class:"mb-4"},de={class:"mb-4"},re={class:"mb-4"},ie={class:"bg-white rounded-lg p-4 shadow-md mb-2 overflow-x-auto"},ce={class:"table-auto w-full"},ve={class:"py-2"},pe={class:"py-2"},me={class:"py-2"},_e={class:"py-2"},be={class:"py-2"},fe={class:"py-2"},ye={class:"bg-white rounded-lg p-4 shadow-md ml-lg-2"},he={class:"mb-4 mx-1"},xe={key:0,class:"text-red-500"},ge={class:"mb-4 mx-1"},we={key:0,class:"text-red-500"},Pe={class:"mb-2"},ke={class:"flex items-center mb-2"},Se={class:"mb-2"},Oe=X({__name:"Create",props:{products:{}},setup(W){var V;const S=d(!1),f=d({}),x=d(""),g=d(""),Y=d(""),j=d("completed"),n=d(0),v=d(1),i=d([]),w=W,y=d(((V=w.products[0])==null?void 0:V.id)??null),h=d(null),C=c(()=>w.products.find(s=>s.id===y.value)),N=c(()=>{var s;return((s=C.value)==null?void 0:s.purchase_products)??[]}),P=c(()=>N.value.find(s=>s.id===h.value)),k=c(()=>{var s;return((s=P.value)==null?void 0:s.sale_price)??0}),q=c(()=>k.value*v.value),D=c(()=>i.value.reduce((s,e)=>s+e.total,0)),G=c(()=>n.value/100*D.value),I=c(()=>D.value-G.value);L(y,()=>{var s;h.value=((s=N.value[0])==null?void 0:s.id)??null,v.value=1}),L(n,()=>{n.value<0&&(n.value=0),n.value>100&&(n.value=100)});const M=()=>{var e;if(!C.value||!P.value)return;const s=i.value.find(O=>O.id===P.value.id);s?(s.quantity+=v.value,s.total=s.quantity*s.price):i.value.push({id:P.value.id,name:C.value.name,price:k.value,quantity:v.value,total:q.value}),y.value=((e=w.products[0])==null?void 0:e.id)??null,h.value=null,v.value=1},H=s=>{i.value=i.value.filter(e=>e.id!==s)},J=()=>{if(i.value.length===0){z.error("Please add at least one product to the order.");return}S.value=!0;const s={name:x.value,phone_number:g.value,total_price:D.value,discount:n.value,subtotal_price:I.value,status:j.value,payment_method:Y.value,products:i.value.map(e=>({product_id:e.id,purchase_id:e.id,qty:e.quantity,sale_price:e.price,total_price:e.total}))};te.post(route("admin.order.store"),s,{onSuccess:()=>{i.value=[],x.value="",g.value="",n.value=0},onError:e=>{console.error(e),e&&(f.value=e),z.error("Failed to create order. Please check inputs.")},onFinish:()=>{S.value=!1}})};return(s,e)=>{const O=p("a-spin"),u=p("a-col"),B=p("a-select"),m=p("a-input"),T=p("a-button"),A=p("a-row"),K=p("a-tooltip");return b(),_($,null,[S.value?(b(),_("div",ae,[t(O,{size:"large"})])):U("",!0),t(R,null,{default:o(()=>[t(Q(Z),{title:"Create Order"}),t(A,{class:"bg-white rounded-lg p-4 shadow-md gap-2"},{default:o(()=>[t(u,{xs:24,lg:24},{default:o(()=>e[7]||(e[7]=[l("h1",{class:"text-2xl"},"Create Order",-1)])),_:1}),t(u,{xs:24,sm:12,lg:5},{default:o(()=>[l("div",se,[e[8]||(e[8]=l("label",{class:"block"},"Select Product",-1)),t(B,{value:y.value,"onUpdate:value":e[0]||(e[0]=a=>y.value=a),"show-search":"",placeholder:"Search and Select Product","option-filter-prop":"label",style:{width:"100%"},options:w.products.map(a=>({value:a.id,label:a.name}))},null,8,["value","options"])])]),_:1}),t(u,{xs:24,sm:11,lg:5},{default:o(()=>[l("div",oe,[e[9]||(e[9]=l("label",{class:"block"},"Select Sale Price",-1)),t(B,{value:h.value,"onUpdate:value":e[1]||(e[1]=a=>h.value=a),placeholder:"Price",style:{width:"100%"},options:N.value.map(a=>({value:a.id,label:`Sale Price: ${a.sale_price} (Stock: ${a.remaining_stock})`}))},null,8,["value","options"])])]),_:1}),t(u,{xs:24,sm:12,lg:3},{default:o(()=>[l("div",ue,[e[10]||(e[10]=l("label",{class:"block"},"Final Price",-1)),t(m,{type:"number",value:k.value,"onUpdate:value":e[2]||(e[2]=a=>k.value=a),class:"w-full",placeholder:"Final Price"},null,8,["value"])])]),_:1}),t(u,{xs:24,sm:11,lg:2},{default:o(()=>[l("div",ne,[e[11]||(e[11]=l("label",null,"QTY",-1)),t(m,{min:"1",type:"number",value:v.value,"onUpdate:value":e[3]||(e[3]=a=>v.value=a),class:"w-full",placeholder:"Enter Quantity"},null,8,["value"])])]),_:1}),t(u,{xs:24,sm:12,lg:4},{default:o(()=>[l("div",de,[e[12]||(e[12]=l("label",null,"Total",-1)),t(m,{readonly:"",value:q.value,class:"w-full",placeholder:"Total Price"},null,8,["value"])])]),_:1}),t(u,{xs:24,sm:11,lg:2},{default:o(()=>[l("div",re,[e[14]||(e[14]=l("label",{class:"block"},"Action",-1)),t(T,{type:"primary",block:"",onClick:M},{default:o(()=>e[13]||(e[13]=[F("ADD")])),_:1})])]),_:1})]),_:1}),t(A,{class:"mt-4 justify-between"},{default:o(()=>[t(u,{xs:24,lg:15},{default:o(()=>[l("div",ie,[l("table",ce,[e[16]||(e[16]=l("thead",null,[l("tr",{class:"text-left"},[l("th",null,"Sr"),l("th",null,"Product"),l("th",null,"Price"),l("th",null,"QTY"),l("th",null,"Total"),l("th",null,"Action")])],-1)),l("tbody",null,[(b(!0),_($,null,ee(i.value,(a,E)=>(b(),_("tr",{key:E},[l("td",ve,r(E+1),1),l("td",pe,r(a.name),1),l("td",me,r(a.price),1),l("td",_e,r(a.quantity),1),l("td",be,r(a.total),1),l("td",fe,[t(K,{placement:"top"},{title:o(()=>e[15]||(e[15]=[F("Delete")])),default:o(()=>[t(T,{type:"text",class:"text-red-700 hover:text-red-800",onClick:Ce=>H(a.id)},{default:o(()=>[t(Q(le))]),_:2},1032,["onClick"])]),_:2},1024)])]))),128))])])])]),_:1}),t(u,{xs:24,lg:8},{default:o(()=>[l("div",ye,[t(A,null,{default:o(()=>[t(u,{xs:24},{default:o(()=>e[17]||(e[17]=[l("div",{class:"bg-gray-300 p-2 mb-4"},[l("h3",{class:"text-2xl"},"Order Summary")],-1)])),_:1}),t(u,{sm:12,xs:24},{default:o(()=>[l("div",he,[e[18]||(e[18]=l("label",{class:"block"},"Name",-1)),t(m,{value:x.value,"onUpdate:value":e[4]||(e[4]=a=>x.value=a),class:"mt-2 w-full",placeholder:"Name"},null,8,["value"]),f.value.name?(b(),_("div",xe,r(f.value.name),1)):U("",!0)])]),_:1}),t(u,{sm:12,xs:24},{default:o(()=>[l("div",ge,[e[19]||(e[19]=l("label",{class:"block"},"Phone Number",-1)),t(m,{type:"number",value:g.value,"onUpdate:value":e[5]||(e[5]=a=>g.value=a),class:"mt-2 w-full",placeholder:"Phone Number"},null,8,["value"]),f.value.phone_number?(b(),_("div",we,r(f.value.phone_number),1)):U("",!0)])]),_:1}),t(u,{xs:24},{default:o(()=>[l("div",null,[l("h4",Pe,"Subtotal: "+r(I.value),1),l("div",ke,[l("h4",null,"Discount ("+r(n.value)+"%):",1),t(m,{min:"0",max:"100",type:"number",value:n.value,"onUpdate:value":e[6]||(e[6]=a=>n.value=a),class:"w-52 ml-3",placeholder:"Discount (%)"},null,8,["value"])]),l("h4",Se,"Total: "+r(q.value),1)]),t(T,{type:"primary",class:"w-full",onClick:J},{default:o(()=>e[20]||(e[20]=[F("Generate Order")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})],64)}}});export{Oe as default};
